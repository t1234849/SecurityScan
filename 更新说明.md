# 🔄 插件更新说明

## v1.1 - 移除自动修复功能

### 📝 变更内容

**移除了所有 QuickFix（快速修复）功能**，现在插件只提供：
- ✅ **实时检测**：发现安全问题立即标记
- ✅ **详细提示**：悬浮显示完整的安全建议
- ✅ **修复指导**：提供具体的代码示例

### 🤔 为什么移除自动修复？

1. **避免类型不匹配问题**
   - 自动替换代码可能导致类型不匹配
   - 不同项目的依赖和API可能不同
   
2. **更安全的整改方式**
   - 开发者手动修复，更了解上下文
   - 避免自动修复引入新的问题
   
3. **提供更详细的指导**
   - 详细的问题说明
   - 多种修复方案供选择
   - 完整的代码示例

### 📋 现在的使用方式

#### 1. 发现问题
```java
JSONObject obj = JSON.parseObject(userInput);
                 ^^^^^^^^^^^^^^^^ 🔥 红色波浪线
```

#### 2. 查看详细提示
鼠标悬停在红色波浪线上，会显示：

```
🚨 严重安全风险：Fastjson 反序列化漏洞

【问题】使用Fastjson反序列化可能导致远程代码执行

【修复建议】
1. 【推荐】替换为 Jackson
   ObjectMapper mapper = new ObjectMapper();
   MyClass obj = mapper.readValue(jsonString, MyClass.class);

2. 替换为 Gson
   Gson gson = new Gson();
   MyClass obj = gson.fromJson(jsonString, MyClass.class);

3. 如必须使用 Fastjson，请：
   - 升级到最新版本
   - 启用 SafeMode: ParserConfig.getGlobalInstance().setSafeMode(true);
   - 使用白名单: ParserConfig.getGlobalInstance().addAccept("com.yourcompany.");

【为什么危险】
Fastjson 的 AutoType 功能允许攻击者通过 @type 字段指定类名，
可以实例化恶意类（如 JdbcRowSetImpl），执行任意代码。
```

#### 3. 手动修复
根据提示信息，手动修改代码：

```java
// 修改前
JSONObject obj = JSON.parseObject(userInput);

// 修改后（选择方案1）
ObjectMapper mapper = new ObjectMapper();
MyClass obj = mapper.readValue(userInput, MyClass.class);
```

### 🎯 对比变化

| 功能 | v1.0（旧版本） | v1.1（当前版本） |
|------|--------------|---------------|
| **实时检测** | ✅ | ✅ |
| **问题标记** | ✅ | ✅ |
| **简单提示** | ✅ | ❌ 改为详细提示 |
| **详细提示** | ❌ | ✅ |
| **QuickFix** | ✅ Alt+Enter 自动修复 | ❌ 已移除 |
| **修复示例** | ⚠️ 简单 | ✅ 详细完整 |
| **类型安全** | ⚠️ 可能有问题 | ✅ 无风险 |

### 📚 新的提示信息包含

每个安全问题的提示都包含：

1. **🚨 风险级别**：高危/警告
2. **【问题】**：说明为什么不安全
3. **【修复建议】**：
   - 多种修复方案
   - 完整的代码示例
   - 优先级标注（推荐/必须等）
4. **【攻击示例】**：展示实际攻击场景
5. **【为什么危险】**：深入解释安全原理
6. **【国内审计要求】**：奇安信、等保等标准

### 🔍 支持的检测（不变）

| 检测项 | 风险级别 | 状态 |
|--------|---------|------|
| Fastjson 反序列化 | 🔥 高危 | ✅ |
| SQL 注入 | 🔥 高危 | ✅ |
| Java 原生反序列化 | 🔥 高危 | ✅ |
| 命令注入 | 🔥 高危 | ✅ |
| 路径遍历 | ⚠️ 警告 | ✅ |
| SSRF | ⚠️ 警告 | ✅ |

### 💡 使用建议

1. **开发阶段**
   - 实时查看安全提示
   - 根据建议逐个修复
   - 理解每个问题的原理

2. **代码审查**
   - 检查所有标记的问题
   - 确保都已正确修复
   - 可以截图提示信息作为文档

3. **安全培训**
   - 详细的提示信息是很好的学习材料
   - 可以用来培训团队成员
   - 理解常见安全问题

### ❓ 常见问题

**Q1: 为什么不能一键修复了？**
A: 为了避免自动修复引入类型不匹配等问题，现在提供更详细的指导让你手动修复，这样更安全可靠。

**Q2: 提示信息在哪里看？**
A: 将鼠标悬停在红色/黄色波浪线上即可查看完整提示。也可以打开 Problems 窗口查看所有问题。

**Q3: 提示信息太长怎么办？**
A: 提示信息虽长但很有价值，包含了完整的修复方案和示例代码，建议仔细阅读。

**Q4: 可以批量修复吗？**
A: 目前需要逐个手动修复。但每个提示都有详细的示例代码，复制粘贴即可。

### 🚀 下一步

1. **测试新版本**
   ```bash
   ./gradlew runIde
   ```

2. **查看测试文件**
   - `SecurityTestExamples.java` - 通用安全测试
   - `MyBatisSecurityExamples.java` - MyBatis 专项测试

3. **体验新的提示信息**
   - 打开测试文件
   - 查看详细的安全提示
   - 根据建议修复问题

---

**版本历史：**
- **v1.1** (当前) - 移除QuickFix，增强提示信息
- **v1.0** - 初始版本，包含QuickFix功能

---

<div align="center">

**更安全、更可靠的代码安全检测 🛡️**

</div>

