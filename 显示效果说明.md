# 🎨 显示效果说明

## ✅ 已更新：所有问题统一显示黄色波浪线

### 📋 修改内容

**所有安全问题现在都显示为黄色波浪线** ⚠️，而不是红色错误标记。

### 🔧 修改的文件

1. ✅ **SecurityInspectionBase.kt** - 修改高亮类型映射逻辑
2. ✅ **plugin.xml** - 修改所有检查项的 level 为 WARNING

### 🎯 修改前后对比

#### ❌ 修改前（v1.1）

```java
JSONObject obj = JSON.parseObject(userInput);
                 ^^^^^^^^^^^^^^^^ 🔴 红色波浪线（高危问题）

File file = new File(userInput);
             ^^^^^^^^^^^^^^^ 🟡 黄色波浪线（警告问题）
```

**问题**：
- 高危问题显示红色，看起来像语法错误
- 代码看起来满屏都是错误，视觉压力大

#### ✅ 修改后（v1.2 当前）

```java
JSONObject obj = JSON.parseObject(userInput);
                 ^^^^^^^^^^^^^^^^ 🟡 黄色波浪线

File file = new File(userInput);
             ^^^^^^^^^^^^^^^ 🟡 黄色波浪线

String sql = "SELECT * FROM users WHERE id=" + id;
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 🟡 黄色波浪线
```

**优势**：
- ✅ 所有安全问题统一显示黄色波浪线
- ✅ 更柔和，不会让代码看起来像满屏错误
- ✅ 视觉上更舒适，减少干扰
- ✅ 依然能清晰标识安全问题

### 🔍 具体的显示效果

#### 1. 代码编辑器中
```java
public class Example {
    public void test(String userInput) {
        // 黄色波浪线
        JSONObject obj = JSON.parseObject(userInput);
        
        // 黄色波浪线
        String sql = "SELECT * FROM users WHERE name = '" + userInput + "'";
        
        // 黄色波浪线
        File file = new File(userInput);
        
        // 黄色波浪线
        URL url = new URL(userInput);
    }
}
```

**每行有问题的代码下方都会显示黄色波浪线 ~~~~~~~~~~~~**

#### 2. 鼠标悬停效果

当鼠标悬停在黄色波浪线上时，会显示：

```
⚠️ 安全风险：Fastjson 反序列化漏洞

【问题】使用Fastjson反序列化可能导致远程代码执行

【修复建议】
1. 【推荐】替换为 Jackson
   ObjectMapper mapper = new ObjectMapper();
   MyClass obj = mapper.readValue(jsonString, MyClass.class);

2. 替换为 Gson
   ...

【攻击示例】
输入: {"@type":"com.sun.rowset.JdbcRowSetImpl",...}
结果: 远程代码执行
```

#### 3. Problems 窗口中

打开 `View → Tool Windows → Problems`，可以看到：

```
⚠️ Security
  ⚠️ Fastjson反序列化漏洞（高危）
     - SecurityTest.java:10  JSON.parseObject(userInput)
  ⚠️ SQL注入漏洞检测（高危）
     - SecurityTest.java:15  "SELECT * FROM ..." + userInput
  ⚠️ 路径遍历风险检测
     - SecurityTest.java:20  new File(userInput)
```

所有问题都显示黄色警告图标 ⚠️，而不是红色错误图标 🔴

### 📊 问题级别对照表

| 问题类型 | 原始风险级别 | 显示颜色 | 图标 |
|---------|------------|---------|------|
| Fastjson 反序列化 | CRITICAL（严重） | 🟡 黄色 | ⚠️ |
| SQL 注入 | CRITICAL（严重） | 🟡 黄色 | ⚠️ |
| Java 反序列化 | CRITICAL（严重） | 🟡 黄色 | ⚠️ |
| 命令注入 | CRITICAL（严重） | 🟡 黄色 | ⚠️ |
| 路径遍历 | ERROR（错误） | 🟡 黄色 | ⚠️ |
| SSRF | ERROR（错误） | 🟡 黄色 | ⚠️ |

**注意**：虽然显示都是黄色，但在提示信息中仍然会标注风险级别（高危/警告）。

### 💡 为什么这样改？

#### 1. 视觉体验更好
- 红色波浪线会让人误以为是语法错误
- 满屏红色会造成视觉压力
- 黄色更柔和，不会干扰正常编码

#### 2. 符合安全扫描的特点
- 安全问题不是"错误"，而是"警告"
- 代码可以正常运行，只是存在安全风险
- 黄色警告更符合这种特性

#### 3. 不影响功能
- 仍然能清晰标识问题
- 提示信息完全相同
- 不影响问题检测和提示

### 🎯 使用建议

#### 开发阶段
```java
// ✅ 正常编码
public void saveUser(String username) {
    // 看到黄色波浪线 → 鼠标悬停查看
    String sql = "INSERT INTO users VALUES('" + username + "')";
    //          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    //          黄色波浪线提示：SQL注入风险
}
```

#### 代码审查
1. 打开 Problems 窗口
2. 筛选 Security 分组
3. 查看所有黄色警告
4. 逐个检查和修复

#### 安全测评前
1. 确保没有黄色波浪线的安全问题
2. 或者确认所有问题都已评估过
3. 准备好修复说明文档

### ✅ 测试方法

```bash
# 运行插件
./gradlew runIde

# 或使用脚本
./build-and-run.sh  # Linux/Mac
build-and-run.bat   # Windows
```

然后：
1. 打开测试文件 `SecurityTestExamples.java`
2. 观察所有问题都是**黄色波浪线** ~~~~~~~~~~~~
3. 鼠标悬停查看详细提示
4. 在 Problems 窗口中查看所有 ⚠️ 警告

### 🔄 版本历史

- **v1.2** (当前) - 统一显示黄色波浪线，优化视觉体验
- **v1.1** - 移除QuickFix，增强提示信息
- **v1.0** - 初始版本

---

<div align="center">

**更舒适的视觉体验，更专业的安全检测 🛡️**

</div>

